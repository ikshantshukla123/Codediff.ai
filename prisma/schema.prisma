generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ðŸ‘¤ THE USER (Synced from Clerk)
model User {
  id             String       @id // Matches Clerk ID (user_2N...)
  email          String       @unique
  name           String?      // GitHub Name
  avatar         String?      // GitHub Avatar URL
  createdAt      DateTime     @default(now())
  
  repositories   Repository[]
}

// ðŸ“¦ THE REPOSITORY
model Repository {
  id             String     @id @default(uuid())
  githubRepoId   Int        // GitHub's ID (e.g., 123456)
  name           String     // "owner/repo-name"
  installationId Int        // Crucial for "Auto-Fix" write access
  
  userId         String
  user           User       @relation(fields: [userId], references: [id])
  
  analyses       Analysis[]
  createdAt      DateTime   @default(now())

  @@unique([githubRepoId, userId])
}

// ðŸ“Š THE AUDIT REPORT
model Analysis {
  id             String     @id @default(uuid())
  repoId         String
  repository     Repository @relation(fields: [repoId], references: [id])
  
  prNumber       Int
  riskScore      Int
  financialRisk  String
  bugs           Json
  tags           String[]
  
  createdAt      DateTime   @default(now())
}