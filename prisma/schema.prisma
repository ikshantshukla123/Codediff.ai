generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url= env("DATABASE_URL")
}

// ðŸ‘¤ THE USER (Synced from Clerk)
model User {
  id             String       @id // Matches Clerk ID (user_2N...)
  email          String       @unique
  name           String?      // GitHub Name
  avatar         String?      // GitHub Avatar URL
  createdAt      DateTime     @default(now())
  
  githubId       Int?
  repositories   Repository[]
}

// ðŸ“¦ THE REPOSITORY
model Repository {
  id             String     @id @default(uuid())
  githubRepoId   Int        // GitHub's ID (e.g., 123456)
  name           String     // "owner/repo-name"
  installationId Int        // Crucial for "Auto-Fix" write access
  
  userId         String
  user           User       @relation(fields: [userId], references: [id])
  
  analyses       Analysis[]
  createdAt      DateTime   @default(now())

  @@unique([githubRepoId, userId])
}

// ðŸ“Š THE AUDIT REPORT
model Analysis {
  id          String     @id @default(cuid())
  createdAt   DateTime   @default(now())
  
  // Existing fields
  riskScore   Int
  bugs        Json       // The AI report
  
  // ðŸ‘‡ NEW FIELDS (Add these)
  status      String     @default("PENDING") // e.g. "SECURE", "VULNERABLE"
  issuesFound Int        @default(0)         // Count of bugs found
  
  // Relations
  repository  Repository @relation(fields: [repositoryId], references: [id])
  repositoryId String
  
  prNumber    Int        // Ensure this matches exactly
}